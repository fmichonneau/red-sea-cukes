sources:
  - R/genFasta.R
  - R/find_sister.R
  - R/load_cukeDB.R

packages:
  - ape
  - phylobase
  - ggplot2
  - igraph
  - doMC
  - seqManagement
  - maps
  - sp
  - rgeos

targets:
  all:
    depends:
      - data

  data:
    depends:
      - im_files
      - data/im_files/infile.list
      - data/im_files/batch.masterIn.fromIM
      - tmp/check_labels.pdf

  list_sister_with_dup:
    command: find_sister(tree="data/raxml-epa-input/RAxML_labelledTree.epaTest")

  list_sister:
    command: rm_duplicate_seq(list_sister_with_dup)

  cukeDB:
    command: load_cukeDB(cukeDB_noLabels)

  cukeDB_noLabels:
    command: load_cukeDB_noLabels(echinoDB)

  ## using the old version so it matches what's in the tree
  echinoDB:
    command: load_echinoDB(file="data/raw/MARBoL_Echinos_VIII_2013.csv")
    ## command: load_echinoDB(file="data/raw/20141812.MARBoL_Echinos_current.csv")

  im_files:
    command: make_im_file(seqs=list_sister,
                          alg_file="data/raxml-epa-input/epa-input.phy",
                          cukeDB=cukeDB, to_ignore_file="data/species_to_ignore.txt",
                          to_add_file="data/species_to_add.txt")

  data/im_files/infile.list:
    command: make_infile(im_files, dest=target_name)

  data/im_files/batch.masterIn.fromIM:
    depends: data/im_files/infile.list
    command: run_convertIM()

  data/im_files/check_labels.pdf:
  tmp/check_labels.pdf:
    command: check_tree_labels(im_files, tree_file="data/raxml-epa-input/RAxML_labelledTree.epaTest",
                               dest="tmp/check_labels.pdf")
